# 中医药膳 AI 推荐系统

## 数据库设计文档

### 1. 概述

本系统的目标是通过用户的健康画像，结合中医药膳与中药奶茶知识库，利用 AI 算法为用户生成个性化推荐。数据库设计涵盖以下功能模块：

- 用户管理（注册、登录、微信授权登录）
- 健康画像管理（支持多次填写历史存档）
- 药膳与中药奶茶知识库（统一存储）
- 推荐记录存储（保存画像与推荐菜品的对应关系）
- 内容管理（文章/视频）与收藏功能（扩展）

------

### 2. 数据库概览

数据库名：`tcm_ai`

主要表结构如下：

| 表名                 | 说明                |
| -------------------- | ------------------- |
| `t_user`             | 用户主表            |
| `t_user_auth`        | 用户登录凭证表      |
| `health_profile`     | 健康画像表          |
| `recipe`             | 药膳/奶茶知识库表   |
| `recommendation`     | 推荐记录表          |
| `t_content`          | 内容表（文章/视频） |
| `t_content_favorite` | 内容收藏表          |

------

### 3. 表设计

#### 3.1 用户主表（t_user）

存储用户的基本信息。

```
CREATE TABLE t_user (
    user_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '用户唯一ID',
    nickname VARCHAR(50) COMMENT '用户昵称（微信昵称/自定义昵称）',
    avatar_url VARCHAR(255) COMMENT '用户头像URL',
    phone VARCHAR(20) UNIQUE COMMENT '手机号（普通登录账号或联系信息）',
    status TINYINT DEFAULT 1 COMMENT '用户状态：1-正常，0-禁用',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '账号创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '信息更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户主表';
```

------

#### 3.2 用户登录凭证表（t_user_auth）

支持微信登录与普通账号登录。

```
CREATE TABLE t_user_auth (
    auth_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '凭证ID',
    user_id BIGINT NOT NULL COMMENT '关联的用户ID',
    auth_type TINYINT NOT NULL COMMENT '登录方式：1-微信，2-账号密码',
    identity VARCHAR(64) NOT NULL COMMENT '登录标识：openid 或账号名/手机号',
    credential VARCHAR(128) COMMENT '凭证：微信为空，普通账号存加密密码',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_auth_type_identity (auth_type, identity),
    FOREIGN KEY fk_auth_user (user_id) REFERENCES t_user(user_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户登录凭证表';
```

------

#### 3.3 健康画像表（health_profile）

记录用户多次填写的健康画像。

```
CREATE TABLE health_profile (
    profile_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '健康画像ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    age INT COMMENT '年龄',
    gender TINYINT COMMENT '1=男, 0=女',
    blood_pressure TINYINT COMMENT '-1=偏低, 0=正常, 1=偏高',
    blood_sugar TINYINT COMMENT '-1=偏低, 0=正常, 1=偏高',
    symptoms JSON COMMENT '身体状况标签，如 ["疲劳","失眠"]',
    diseases JSON COMMENT '疾病史标签，如 ["高血压","糖尿病"]',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '填写时间',
    FOREIGN KEY (user_id) REFERENCES t_user(user_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='健康画像表';
```

> 一个用户可有多条记录，每条记录对应一次填写。

------

#### 3.4 药膳/中药奶茶表（recipe）

存储药膳与中药奶茶信息，用 `type` 区分。

```
CREATE TABLE recipe (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '菜品ID',
    type TINYINT NOT NULL COMMENT '0=药膳, 1=中药奶茶',
    name VARCHAR(100) NOT NULL COMMENT '名称',
    intro TEXT COMMENT '简介',
    taboo TEXT COMMENT '饮食忌口',
    effect TEXT COMMENT '药膳=主治；奶茶=功能',
    suitable_time VARCHAR(50) COMMENT '适宜饮用时间',
    method TEXT COMMENT '做法',
    tags JSON COMMENT '功能标签，如 ["养生","祛湿","安神"]',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='药膳/奶茶表';
```

------

#### 3.5 推荐记录表（recommendation）

存储某个健康画像对应的推荐结果。

```
CREATE TABLE recommendation (
    rec_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '推荐记录ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    profile_id BIGINT NOT NULL COMMENT '健康画像ID',
    recipe_id BIGINT NOT NULL COMMENT '推荐菜品ID',
    recommend_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '推荐时间',
    FOREIGN KEY (user_id) REFERENCES t_user(user_id) ON DELETE CASCADE,
    FOREIGN KEY (profile_id) REFERENCES health_profile(profile_id) ON DELETE CASCADE,
    FOREIGN KEY (recipe_id) REFERENCES recipe(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_profile_recipe (user_id, profile_id, recipe_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='推荐记录表';
```

------

#### 3.6 内容表（t_content）

用于文章/视频资料管理。

```
CREATE TABLE t_content (
    content_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '内容ID',
    title VARCHAR(100) NOT NULL COMMENT '标题',
    description TEXT COMMENT '简介',
    content_type VARCHAR(20) NOT NULL COMMENT '类型：article/video',
    image_url VARCHAR(255) COMMENT '封面图',
    video_url VARCHAR(255) COMMENT '视频URL',
    author_id BIGINT COMMENT '作者ID',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (author_id) REFERENCES t_user(user_id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='内容表';
```

------

#### 3.7 收藏表（t_content_favorite）

用户收藏文章/视频。

```
CREATE TABLE t_content_favorite (
    fav_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '收藏ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    content_id BIGINT NOT NULL COMMENT '内容ID',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '收藏时间',
    FOREIGN KEY (user_id) REFERENCES t_user(user_id) ON DELETE CASCADE,
    FOREIGN KEY (content_id) REFERENCES t_content(content_id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_content (user_id, content_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收藏表';
```

------

### 4. 表关系说明

- `t_user` ↔ `t_user_auth`：一对多（一个用户可有多种登录方式）。
- `t_user` ↔ `health_profile`：一对多（用户可多次填写健康画像）。
- `health_profile` ↔ `recommendation`：一对多（每份画像对应多条推荐记录）。
- `recommendation` ↔ `recipe`：多对一（每条推荐对应某个药膳/奶茶）。
- `t_user` ↔ `t_content`：一对多（用户可发布内容）。
- `t_user` ↔ `t_content_favorite`：一对多（用户可收藏多个内容）。

------

### 5. 业务流程示例

1. 用户登录（微信 / 普通账号）。
2. 填写健康画像 → `health_profile` 新增记录。
3. 系统调用 AI 推荐菜品 → 写入 `recommendation` 表。
4. 用户可在前端查看历史画像 & 推荐记录。
5. 用户可浏览内容文章/视频，并收藏。